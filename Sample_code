package runner;

import java.io.IOException;

import java.text.SimpleDateFormat;
import java.util.Date;

import org.openqa.selenium.By;
import org.testng.Assert;
import org.testng.annotations.AfterClass;
import org.testng.annotations.AfterMethod;
import org.testng.annotations.BeforeClass;
import org.testng.annotations.BeforeMethod;
import org.testng.annotations.Test;

import com.aventstack.extentreports.ExtentReports;
import com.aventstack.extentreports.ExtentTest;
import com.aventstack.extentreports.Status;

import utils.Base;
import utils.ExcelReader;
import utils.LoggerHandler;
import utils.Reporter;
import utils.WebDriverHelper;
public class TestRunner extends Base{
   WebDriverHelper helper;
    ExtentReports reports;
    ExtentTest test;
   @BeforeClass
   public void rep(){
    reports = Reporter.generateExtentReport("itchotel_report");
   }

    @BeforeMethod
    public void open(){
        openBrowser();
    }

    @Test
    public void testcase() throws InterruptedException, IOException{
        helper = new WebDriverHelper(driver);
        test = reports.createTest("Test1");
        Thread.sleep(5000);
        String timestamp = new SimpleDateFormat("yyyyMMdd_HHmmss").format(new Date());
        driver.findElement(By.xpath("//button[text()='Manage Cookies']")).click();
        Thread.sleep(1000);
        LoggerHandler.info("click on know more");

        String text = helper.getText(By.xpath("//h2[text()='Privacy Preference Center']"));
        Assert.assertEquals(text, "Privacy Preference Center");
        Thread.sleep(1000);
        Reporter.attachScreenshotToReport("itc_screenshot_" + timestamp,test,"Screenshot found");
        
        driver.findElement(By.xpath("//button[@id='close-pc-btn-handler']")).click();
        Thread.sleep(2000);
        helper.javascriptScroll(By.xpath("//div[@id='footer-accordion__content_5']/ul/li[2]/a"));
        Thread.sleep(2000);
        helper.clickOnElement(By.xpath("//div[@id='footer-accordion__content_5']/ul/li[2]/a"));
        Thread.sleep(3000);
        helper.switchToNewWindow();
        helper.clickOnElement(By.xpath("//a[text()='Click here']"));
        Thread.sleep(3000);
        
        helper.javascriptScroll(By.xpath("//div[@id='footer-accordion__content_2']/ul/li[5]/a"));
        Thread.sleep(2000);
        helper.clickOnElement(By.xpath("//div[@id='footer-accordion__content_2']/ul/li[5]/a"));
        Thread.sleep(3000);
        Reporter.attachScreenshotToReport("itc_screenshot_" + timestamp,test,"Screenshot sustaniablity found");
        
        
        helper.javascriptScroll(By.xpath("(//div[@id='footer-accordion__content_3']/ul/li[1]/ul/li/a)[1]"));
        Thread.sleep(2000);
        helper.clickOnElement(By.xpath("(//div[@id='footer-accordion__content_3']/ul/li[1]/ul/li/a)[1]"));
        Thread.sleep(3000);
        
        helper.clickOnElement(By.xpath("(//button[@id='loginDropdownMenuButton']/span/span)[1]"));
        Thread.sleep(1000);
        
        helper.clickOnElement(By.xpath("//div[@class='itc-login__before-login']/a[2]/span"));
        Thread.sleep(2000);
        String email = ExcelReader.readdata("testdata/Data.xlsx", "Sheet1", 0, 0);
        String password = ExcelReader.readdata("testdata/Data.xlsx", "Sheet1", 1, 0);
        
        helper.sendKeys(By.name("mobileNumber"), email);
        Thread.sleep(2000);
        helper.sendKeys(By.name("mobEmailPassword"), password);
        Thread.sleep(2000);
        
        helper.clickOnElement(By.xpath("//button[@class='cmp-button btn-prim-outline btn-rounded']/span"));
        
        helper.clickOnElement(By.xpath("//button[@class='cmp-button btn-prim-outline btn-rounded']/span"));
        test.log(Status.PASS, "hover on signin");
        Reporter.attachScreenshotToReport("itc_screenshot_" + timestamp,test,"Screenshot login found");
        Thread.sleep(3000);

    }

    @AfterMethod
    public void teardown(){
        driver.quit();
    }

    @AfterClass
    public void empty(){
        reports.flush();
    }
}
